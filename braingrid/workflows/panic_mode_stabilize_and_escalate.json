{
  "id": "workflow.panic.stabilize.escalate",
  "name": "Panic Mode: Stabilize and Escalate",
  "version": "1.1.0",
  "inputs": [
    { "key": "user_state", "type": "string", "description": "anxious, panicking, confused, overheated, unwell, other" },
    { "key": "symptoms", "type": "array", "description": "symptom keywords", "items": { "type": "string" } },
    { "key": "severity", "type": "string", "description": "low, medium, high, critical" },
    { "key": "location_context", "type": "string", "description": "optional venue/stage/area" }
  ],
  "steps": [
    {
      "id": "severity_mapping",
      "action": "Map severity to canonical UI semantics using core severity map, icon map, and motion rules",
      "checks": [
        "severity in [low, medium, high, critical]"
      ],
      "produces": [
        "severity_label",
        "severity_color",
        "severity_icon",
        "escalation_level"
      ]
    },
    {
      "id": "red_flag_check",
      "action": "Check symptoms against core/red_flags.json; if any present then escalation_level = emergency and red_flags_detected = true",
      "checks": [
        "core/red_flags.json is canonical",
        "If any red flag is present -> escalation_level must be emergency"
      ],
      "produces": [
        "red_flags_detected",
        "escalation_directive"
      ]
    },
    {
      "id": "stabilize_script",
      "action": "Generate calm, step-by-step stabilize instructions (no surveillance language, no illegal instructions)",
      "checks": [
        "Short steps",
        "Breathing + grounding included",
        "Cooling and hydration guidance included when relevant",
        "Encourage buddy support"
      ],
      "produces": [
        "stabilize_steps"
      ]
    },
    {
      "id": "help_script",
      "action": "Generate get-help instructions appropriate to escalation level; include emergency instruction from core/red_flags.json",
      "checks": [
        "Emergency escalation includes call emergency services guidance",
        "Medical escalation includes on-site medical guidance"
      ],
      "produces": [
        "get_help_steps",
        "triage_recommendation"
      ]
    },
    {
      "id": "ui_copy_assembly",
      "action": "Assemble Panic Mode UI copy following WHAT/RISK/DO NOW/GET HELP pattern",
      "produces": [
        "panic_title",
        "panic_subtitle",
        "risk_summary",
        "do_now_bullets",
        "notification_title",
        "notification_body"
      ]
    }
  ],
  "outputs": [
    { "key": "panic_title", "type": "string" },
    { "key": "panic_subtitle", "type": "string" },

    { "key": "severity_label", "type": "string" },
    { "key": "severity_color", "type": "string" },
    { "key": "severity_icon", "type": "string" },
    { "key": "red_flags_detected", "type": "boolean" },

    { "key": "risk_summary", "type": "string" },
    { "key": "stabilize_steps", "type": "array", "items": { "type": "string" } },
    { "key": "do_now_bullets", "type": "array", "items": { "type": "string" } },
    { "key": "get_help_steps", "type": "array", "items": { "type": "string" } },
    { "key": "triage_recommendation", "type": "string" },

    { "key": "notification_title", "type": "string" },
    { "key": "notification_body", "type": "string" }
  ]
}
